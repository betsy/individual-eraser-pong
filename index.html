<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8" />
        <title>Socket.io</title>
    </head>
 
    <body>
        <canvas id="myCanvas"></canvas>
            <script src="/socket.io/socket.io.js"></script>
            <script>
              var socket = io.connect('http://localhost:3000');
              // var canvas = document.getElementById('myCanvas');
              // var context = canvas.getContext('2d');

              // context.beginPath();
              // context.rect(100, 50, 200, 100);
              // context.fillStyle = 'yellow';
              // context.fill();
              // context.lineWidth = 2;
              // context.strokeStyle = 'black';
              // context.stroke();
              (function() {
    var requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame || window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
    window.requestAnimationFrame = requestAnimationFrame;
})();

var canvas = document.getElementById("myCanvas"),
 ctx = canvas.getContext("2d"),
 width = 600,
 height = 600;

canvas.width = width;
canvas.height = height;


var width = 600,
    height = 600,
    p1 = {
      x : width/2,
      y : height/2,
      width : 50,
      height : 50,
      speed: 10,
      velX: 0,
      velY: 0,
      jumping: false
    },
    keys = [],
    friction = 0.8,
    gravity = 1.8;

socket.on('p1', function (player) {
  p1 = player;
  console.log(p1.x,p1.y);
})

function draw(player){
  update()
  ctx.clearRect(0,0,width,height);
  ctx.fillStyle = "red";
  ctx.fillRect(p1.x,p1.y, p1.width, p1.height);
  // ctx.fillRect(300,595,500.1,500.1);
  // console.log(p1.x,p1.y, player.width, player.height);
  requestAnimationFrame(draw);
}

document.body.addEventListener("keydown", function(e) {
    // keys[e.keyCode] = true;
    socket.emit ('player move', {keyCode: e.keyCode, val: true});
});
 
document.body.addEventListener("keyup", function(e) {
    // keys[e.keyCode] = false;
    socket.emit ('player move', {keyCode: e.keyCode, val: false});
});
 
window.addEventListener("load",function(){
    draw();
});

function update(){
    if (keys[38] || keys[32]) {
        // up arrow or space
      if(!p1.jumping){
       p1.jumping = true;
       p1.velY = -p1.speed*2;
      }
    }
    if (keys[39]) {
        // right arrow
        if (p1.velX < p1.speed) {             
            p1.velX++;         
         }     
    }     
    if (keys[37]) {         
        // left arrow         
        if (p1.velX > -p1.speed) {
            p1.velX--;
        }
    }
 
    p1.velX *= friction;
 
    p1.velY += gravity;
 
    p1.x += p1.velX;
    p1.y += p1.velY;
 
    if (p1.x >= width-p1.width) {
        p1.x = width-p1.width;
    } else if (p1.x <= 0) {         
        p1.x = 0;     
    }    
  
    if(p1.y >= height-p1.height){
        p1.y = height - p1.height;
        p1.jumping = false;
    }
}
            </script>

        </body>

        <!-- <p><input type="button" value="Poke the server" id="poke" /></p> -->


        <script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
        <!-- <script src="/socket.io/socket.io.js"></script> -->
        <script>
            /*var socket = io.connect('http://localhost:3000');

            // The visitor is asked for their username...
            var username = prompt('What\'s your username?');
            
            // It's sent with the signal "little_newbie" (to differentiate it from "message")
            socket.emit('little_newbie', username);

            // A dialog box is displayed when the server sends us a "message"
            socket.on('message', function(message) {
                alert('The server has a message for you: ' + message);
            })

            // When the button is clicked, a "message" is sent to the server
            // $('#poke').click(function () {
            //     socket.emit('message', 'Hi server, how are you?');
            // })


            document.addEventListener('keydown', function(event) {
                if(event.keyCode == 38) {
                    socket.emit('message', 'Up was pressed');
                }
                else if(event.keyCode == 40) {
                    socket.emit('message', 'Down was pressed');
                }
            });*/
        </script>
    </body>
</html>